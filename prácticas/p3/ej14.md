# Práctica 3 / Ejercicio 14

```c
semaphore puerta = sem(1); // mutex
semaphore caja = sem(1); // mutex

semaphore sofa = sem(4);
semaphore esperandoEnSofa = sem(0);
semaphore quieroPagar = sem(0);
semaphore podesPagar = sem(0);
semaphore pagado = sem(0);
semaphore recibido = sem(0);

int clientesAdentro = 0;
queue<tuple(semaphore, semaphore)> clientes = []; // cola FIFO

void cliente() {
    puerta.wait();

    // Si no hay lugar se va.
    if (clientesAdentro >= 20) {
        puerta.signal();
        return;
    }

    entrar();

    // El cliente crea sus propios semáforos para hablar con el barbero.
    semaphore fromBarbero = sem(0);
    semaphore toBarbero = sem(0);
    clientes.push((fromBarbero, toBarbero));

    puerta.signal();

    sofa.wait();
    sentarseEnSofa();
    esperandoEnSofa.signal();

    fromBarbero.wait(); // sentate en la silla
    sentarseEnSilla();
    sofa.signal(); // liberé el sofa
    toBarbero.signal(); // me senté
    fromBarbero.wait(); // terminó el corte

    quieroPagar.signal();
    podesPagar.wait();
    pagar();
    pagado.signal();
    recibido.wait();

    puerta.wait();
    salir();
    clientesAdentro--;
    puerta.signal();
}

void barbero(i) {
    while (1) {
        esperandoEnSofa.wait();
        semaphore (toCliente, fromCliente) = clientes.pop();

        toCliente.signal(); // sentate en la silla
        fromCliente.wait(); // me senté
        cortarCabello();
        toCliente.signal(); // terminó el corte

        quieroPagar.wait();
        caja.wait();
        podesPagar.signal();
        pagado.wait();
        aceptarPago();
        recibido.signal();
        caja.signal();
    }
}
```
